{
  "name": "PI-Evri-Storage-Baseline",
  "type": "Microsoft.Authorization/policySetDefinitions",
  "apiVersion": "2024-04-01",
  "properties": {
    "policyType": "Custom",
    "displayName": "EVRi Storage Baseline",
    "description": "MC: Storage baseline scoped at the Evri management group. Includes: disable PNA, minimum TLS version, allowed SKUs, secure transfer.",
    "metadata": { "version": "1.0.0", "category": "Storage" },
    "parameters": {
      "minimumTlsVersion": {
        "type": "String",
        "metadata": { "displayName": "Minimum TLS version" },
        "allowedValues": ["TLS1_0", "TLS1_1", "TLS1_2"],
        "defaultValue": "TLS1_2"
      },
      "listOfAllowedSKUs": {
        "type": "Array",
        "metadata": { "displayName": "Allowed storage SKUs" },
        "defaultValue": ["Standard_LRS", "Standard_GRS"]
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "STO-DisablePublicNetworkAccess-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b2982f36-99f2-4db5-8eff-283140c09693",
        "parameters": {},
        "groupNames": ["Resource-Baseline-Storage"]
      },
      {
        "policyDefinitionReferenceId": "STO-MinTLS-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/fe83a0eb-a853-422d-aac2-1bffd182c5d0",
        "parameters": {
          "minimumTlsVersion": { "value": "[parameters('minimumTlsVersion')]" }
        },
        "groupNames": ["Resource-Baseline-Storage"]
      },
      {
        "policyDefinitionReferenceId": "STO-AllowedSkus-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7433c107-6db4-4ad1-b57a-a76dce0154a1",
        "parameters": {
          "listOfAllowedSKUs": { "value": "[parameters('listOfAllowedSKUs')]" }
        },
        "groupNames": ["Resource-Baseline-Storage"]
      },
      {
        "policyDefinitionReferenceId": "STO-SecureTransfer-001",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9",
        "parameters": {},
        "groupNames": ["Resource-Baseline-Storage"]
      }
    ],
    "policyDefinitionGroups": [
      {
        "name": "Resource-Baseline-Storage",
        "displayName": "Resource Baseline - Storage",
        "description": "MC: Grouping for storage baseline controls."
      }
    ]
  }
}
